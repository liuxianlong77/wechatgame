var argusFpsStats,FPSStats=function(){var g=(performance||Date).now(),d=g,e=0;return{REVISION:101,mode:FPSStats.MODE_INIT,inject_engine_draw:function(){var a=null,b=function(){window.engine_draw_flag=!0;if(a)return a.apply(this,[].slice.call(arguments))};window.engine_draw_injected_flag||("undefined"!=typeof Laya&&"undefined"!=typeof Laya.Scene?(a=Laya.Scene.prototype._updateScene,Laya.Scene.prototype._updateScene=b,window.engine_draw_injected_flag=!0):"undefined"!=typeof Laya&&"undefined"!=typeof Laya.stage._loop?
(a=Laya.stage._loop,Laya.stage._loop=b,window.engine_draw_injected_flag=!0):"undefined"!=typeof cc&&"undefined"!=typeof cc.director?(a=cc.director.mainLoop,cc.director.mainLoop=b,window.engine_draw_injected_flag=!0):"undefined"!=typeof egret&&"undefined"!=typeof egret.sys&&"undefined"!=typeof egret.sys.$ticker?(a=egret.sys.$ticker.render,egret.sys.$ticker.render=b,window.engine_draw_injected_flag=!0):"undefined"!=typeof egret&&"undefined"!=typeof egret.ticker&&(a=egret.ticker.render,egret.ticker.render=
b,window.engine_draw_injected_flag=!0))},init:function(){var a=this;d=g=Date.now();e=0;window.engine_draw_flag=!1;window.context_draw_flag=!1;a.inject_cnt=10;a.mode=FPSStats.MODE_INIT;a.deviceId=null;a.token=null;a.deviceType=FPSStats.DEVICE_TYPE;a.fpsCacheSize=FPSStats.FPS_CHACE_SIZE;a.fpsCache=[];a.userDrawList=[];a.version_valid_flag=!1;a.network_error_flag=!1;wx.request({url:FPSStats.PROXY_URL,data:{op:FPSStats.PROXY_OP_JSVERSIONS,deviceType:FPSStats.DEVICE_TYPE,jsv:FPSStats.VERSION},complete:function(b){b.data&&
0===b.data.ret&&b.data.versions?-1===b.data.versions.indexOf(FPSStats.VERSION)?wx.showModal({title:"JS\u811a\u672c\u7248\u672c\u8fc7\u4f4e",content:"\u8bf7\u5230 Wetest Argus \u5b98\u7f51\u4e0b\u8f7d\u6700\u65b0JS\u811a\u672c\uff0c\u5f53\u524d\u7248\u672c\uff1a"+FPSStats.VERSION+"\uff0c\u6700\u65b0\u7248\u672c\uff1a"+b.data.versions,showCancel:!1}):a.version_valid_flag=!0:(wx.showModal({title:"\u7248\u672c\u68c0\u6d4b\u5931\u8d25",content:"\u8bf7\u68c0\u67e5\u624b\u673a\u7f51\u7edc\u8fde\u63a5\u662f\u5426\u6b63\u5e38\u5e76\u91cd\u542f\u6e38\u620f",
showCancel:!1}),a.network_error_flag=!0);a.version_valid_flag&&a.inject_engine_with_check()}})},inject_engine_with_check:function(){var a=this,b=function(){console.log("try to inject...");a.inject_engine_draw();window.engine_draw_injected_flag?(wx.showModal({title:"\u6b22\u8fce\u4f7f\u7528Argus",content:"\u70b9\u51fb\u786e\u5b9a\u540e\uff0c\u5c4f\u5e55\u4e0a\u753b\u5708\u83b7\u5f97TestID",showCancel:!1}),a.mode=FPSStats.MODE_WAIT):(!window.engine_draw_injected_flag&&0<a.inject_cnt&&(console.log("inject failed. wait 500m ..."),
--a.inject_cnt,setTimeout(b,500)),window.engine_draw_injected_flag||0!=a.inject_cnt||wx.showModal({title:"\u65e0\u6cd5\u83b7\u53d6FPS\u6570\u636e",content:"\u6682\u4e0d\u652f\u6301\u5f53\u524d\u6e38\u620f\u5f15\u64ce",showCancel:!1}))};b()},waitForStart:function(){var a=this,b=function(a){if(!(12>a.length)){for(var b=[],c=a.length/12,d=0;12>d;d++)b.push(Math.floor(d*c));var e=0,g=0;b.forEach(function(b){e+=a[b].clientX;g+=a[b].clientY});var l=Math.floor(e/b.length),m=Math.floor(g/b.length),h=0,f=
0,k=c=0;b.forEach(function(b){b=a[b];b=Math.sqrt(Math.pow(b.clientX-l,2)+Math.pow(b.clientY-m,2));h=b>h?b:h;f=0==f?b:f;f=b<f?b:f;k+=b});c=k/12;return h<=parseInt(1.8*c)&&parseInt(1.8*f)>=c&&20<c}};wx.onTouchStart(function(b){a.userDrawList=[];a.userDrawList.push(b.changedTouches[0])});wx.onTouchMove(function(b){if(120<a.userDrawList.length)return!1;a.userDrawList.push(b.changedTouches[0])});wx.onTouchEnd(function(c){a.userDrawList.push(c.changedTouches[0]);if(b(a.userDrawList)){if(a.mode==FPSStats.MODE_INIT){a.init();
return}if(a.deviceId)return wx.showModal({title:"TestID : "+a.deviceId,content:"\u8bf7\u5728ArgusPC\u7aef\u8f93\u5165TestID",showCancel:!1}),!0;wx.request({url:FPSStats.PROXY_URL,data:{op:FPSStats.PROXY_OP_FETCHID,deviceType:a.deviceType,appID:__wxConfig.accountInfo.appID,nickname:__wxConfig.accountInfo.nickname,jsv:FPSStats.VERSION},complete:function(b){b.data&&0===b.data.ret&&0<parseInt(b.data.deviceId)?(a.deviceId=b.data.deviceId,a.token=b.data.token,a.mode=FPSStats.MODE_STAT,wx.showModal({title:"TestID : "+
b.data.deviceId,content:"\u8bf7\u5728ArgusPC\u7aef\u8f93\u5165TestID",showCancel:!1})):b.data&&-2===b.data.ret&&b.data.versions?wx.showModal({title:"JS\u811a\u672c\u7248\u672c\u8fc7\u4f4e",content:"\u8bf7\u5230 Wetest Argus \u5b98\u7f51\u4e0b\u8f7d\u6700\u65b0JS\u811a\u672c\uff0c\u5f53\u524d\u7248\u672c\uff1a"+FPSStats.VERSION+"\uff0c\u6700\u65b0\u7248\u672c\uff1a"+b.data.versions,showCancel:!1}):wx.showModal({title:"\u83b7\u53d6TestID\u5931\u8d25",content:"\u8bf7\u68c0\u67e5\u624b\u673a\u7f51\u7edc\u8fde\u63a5\u662f\u5426\u6b63\u5e38",
showCancel:!1})}})}a.userDrawList=[]})},calc:function(){(window.engine_draw_flag||window.context_draw_flag)&&e++;window.engine_draw_flag=!1;window.context_draw_flag=!1;var a=Date.now();if(a>d+1E3){var b=1E3*e/(a-d);d=a;e=0;this.mode===FPSStats.MODE_STAT&&this.uploadFPS(a,b)}return a},uploadFPS:function(a,b){var c=this;a=a+","+Math.round(b);c.fpsCache.length>=c.fpsCacheSize&&c.fpsCache.shift();c.fpsCache.push(a);a=c.fpsCache.join(";");wx.request({url:FPSStats.PROXY_URL,data:{op:FPSStats.PROXY_OP_UPLOAD,
deviceId:c.deviceId,token:c.token,deviceType:c.deviceType,deviceFps:a},success:function(a){0===a.data.ret&&(c.fpsCache=[])}})},start:function(){function a(){b.calc();requestAnimationFrame(a)}var b=this;if(b.mode!==FPSStats.MODE_INIT)return 0;b.init();b.waitForStart();a()},stop:function(){this.mode=FPSStats.MODE_STOP}}};FPSStats.MODE_STAT=0;FPSStats.MODE_STOP=1;FPSStats.MODE_INIT=2;FPSStats.MODE_WAIT=3;FPSStats.VERSION="1.0.5";FPSStats.DEVICE_TYPE="wx";FPSStats.FPS_CHACE_SIZE=1;
FPSStats.PROXY_URL="https://wetest.qq.com/agsws/";FPSStats.PROXY_OP_JSVERSIONS="js_versions";FPSStats.PROXY_OP_UPLOAD="upload_fps";FPSStats.PROXY_OP_FETCHID="fetch_id";FPSStats.ARGUS_CMD_TEST_START="cmd_test_start";FPSStats.ARGUS_CMD_TEST_STOP="cmd_test_stop";argusFpsStats||(argusFpsStats=new FPSStats);argusFpsStats.start();
